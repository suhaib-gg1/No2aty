<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
<script>
  // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØµØ­ÙŠØ­
  var code = localStorage.getItem('access_code');
  if (!code || code !== 'Tamayoz2025') {
    window.location.replace('index.html');
  }
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ - Ù…Ø¯Ø±Ø³Ø© Ø±ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ…ÙŠØ²</title>
    <link rel="stylesheet" href="css.css">
        <link rel="icon" href="n.icon">

</head>

<body class="student-view">
    <nav class="navbar">
        <div class="nav-container">
            <img src="snapedit_1730146554309.png" class="school-logo" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
            <div class="date-display" id="currentDate"></div>
            <div class="nav-links">
                <!-- Hamburger Menu Button -->
                <button class="hamburger-btn" onclick="toggleMenu()">
                    â˜°
                </button>

                <!-- Mobile Menu -->
                <div class="mobile-menu">
                    <button class="theme-toggle" onclick="toggleTheme()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">
                        <i>ğŸŒ™</i> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
                    </button>
                    <a href="#" class="nav-link" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬" onclick="confirmLogout()">
                        <span class="logout-icon">ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1>ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</h1>
        <img src="logo.png" alt="Ù†Ù‚Ø§Ø·ÙŠ" style="height: 50px;">
        <div class="control-panel">
            <div class="search-box">
                <input type="text" id="studentSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨...">
                <select id="studentClassFilter">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„</option>
                    <option value="1/1">1/1</option>
                    <option value="1/2">1/2</option>
                    <option value="1/3">1/3</option>
                    <option value="2/Ø¹Ø§Ù…">2/Ø¹Ø§Ù…</option>
                    <option value="2/ØµØ­Ø©">2/ØµØ­Ø©</option>
                    <option value="2/Ù‡Ù†Ø¯Ø³Ø©">2/Ù‡Ù†Ø¯Ø³Ø©</option>
                    <option value="3/Ø¹Ø§Ù…">3/Ø¹Ø§Ù…</option>
                    <option value="3/ØµØ­Ø©">3/ØµØ­Ø©</option>
                    <option value="3/Ù‡Ù†Ø¯Ø³Ø©">3/Ù‡Ù†Ø¯Ø³Ø©</option>
                </select>
            </div>
        </div>

        <table id="studentsTable">
            <thead>
                <tr>
                    <th width="15%">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                    <th width="35%">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                    <th width="25%">Ø§Ù„ÙØµÙ„</th>
                    <th width="25%">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                </tr>
            </thead>
            <tbody id="studentsList"></tbody>
        </table>
    </div>

    <footer class="luxury-footer">
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025 ØµÙ‡ÙŠØ¨ Ù…Ø­Ù…Ø¯ Ø¨ÙˆØ²ÙŠØ¯Ø§Ù†</p>
        <p>ÙŠÙÙ…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø± Ø£Ùˆ ØªÙˆØ²ÙŠØ¹ Ø£ÙŠ Ø¬Ø²Ø¡ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ Ø¯ÙˆÙ† Ø¥Ø°Ù† ÙƒØªØ§Ø¨ÙŠ Ù…Ø³Ø¨Ù‚.</p>
        <p>Ù„Ù„ØªÙˆØ§ØµÙ„: <a href="mailto:suhaibwebdev@gmail.com">suhaibwebdev@gmail.com</a></p>
    </footer>

    <div id="logoutConfirmation" class="confirmation-modal">
        <div class="confirmation-content">
            <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ</p>
            <div class="confirmation-buttons">
                <button onclick="performLogout()" class="confirm-btn">Ù†Ø¹Ù…</button>
                <button onclick="closeLogoutModal()" class="cancel-btn">Ù„Ø§</button>
            </div>
        </div>
    </div>

    <style>
    .confirmation-modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
    }
    .confirmation-content {
        background: white;
        width: 300px;
        padding: 20px;
        border-radius: 8px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    .confirmation-buttons {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        justify-content: center;
    }
    .confirm-btn, .cancel-btn {
        padding: 8px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .confirm-btn { background: #4CAF50; color: white; }
    .cancel-btn { background: #f44336; color: white; }
    </style>

    <script>
    function confirmLogout() {
        document.getElementById('logoutConfirmation').style.display = 'block';
    }
    function closeLogoutModal() {
        document.getElementById('logoutConfirmation').style.display = 'none';
    }
    function performLogout() {
        window.location.href = "index.html";
    }
    </script>

    <script>
        let students = [];

        function calculateRanks() {
            const globalSorted = [...students].sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                return a.id - b.id;
            });
            globalSorted.forEach((student, index) => {
                student.globalRank = index + 1;
            });

            const classes = [...new Set(students.map(s => s.class))];
            classes.forEach(cls => {
                const classStudents = students
                    .filter(s => s.class === cls)
                    .sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        return a.id - b.id;
                    });
                classStudents.forEach((student, index) => {
                    student.localRank = index + 1;
                });
            });
        }

        function filterAndSort() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const classFilter = document.getElementById('studentClassFilter').value;

            let result = students;
            if (classFilter) {
                result = result.filter(s => s.class === classFilter);
            }
            if (searchTerm) {
                result = result.filter(s => s.name.toLowerCase().includes(searchTerm));
            }
            return result.sort((a, b) => b.points - a.points || a.id - b.id);
        }

        function updateDisplay() {
            const classFilter = document.getElementById('studentClassFilter').value;
            const filteredStudents = filterAndSort();
            const tbody = document.getElementById('studentsList');
            tbody.innerHTML = '';

            filteredStudents.forEach(student => {
                const row = document.createElement('tr');
                const rank = classFilter ? student.localRank : student.globalRank;
                row.innerHTML = `
                    <td>${rank}</td>
                    <td>${student.name}</td>
                    <td>${student.class}</td>
                    <td>${student.points}</td>
                `;
                if (rank === 1) row.classList.add('gold');
                else if (rank === 2) row.classList.add('silver');
                else if (rank === 3) row.classList.add('bronze');
                else if (rank >= 4 && rank <= 10) row.classList.add('top4-10');
                tbody.appendChild(row);
            });
        }

        function updateDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ar-EG', options);
        }

        document.getElementById('studentSearch').addEventListener('input', updateDisplay);
        document.getElementById('studentClassFilter').addEventListener('change', updateDisplay);

        window.addEventListener('load', () => {
            updateDate();
        });
    </script>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        socket.on("dataUpdated", (newData) => {
            console.log("ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯:", newData);
            students = newData.students;
            calculateRanks();
            updateDisplay();
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„
        socket.on("initialData", (data) => {
            console.log("ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:", data);
            students = data.students;
            calculateRanks();
            updateDisplay();
        });
    </script>

    <script>
    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
    function toggleTheme() {
        const body = document.documentElement;
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø²Ø±
        const themeIcon = document.querySelector('.theme-toggle i');
        themeIcon.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø²Ø±
        const themeIcon = document.querySelector('.theme-toggle i');
        themeIcon.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    });

    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‡Ø§Ù…Ø¨Ø±ØºØ±
    function toggleMenu() {
        const mobileMenu = document.querySelector('.mobile-menu');
        mobileMenu.classList.toggle('active');
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.addEventListener('click', (event) => {
        const mobileMenu = document.querySelector('.mobile-menu');
        const hamburgerBtn = document.querySelector('.hamburger-btn');
        if (!mobileMenu.contains(event.target) && !hamburgerBtn.contains(event.target) && mobileMenu.classList.contains('active')) {
            mobileMenu.classList.remove('active');
        }
    });
    </script>
</body>
</html>