<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
<script>
  // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ù…Ø³ØªØ®Ø¯Ù… ØµØ§Ù„Ø­Ø©
  const userType = localStorage.getItem('user_type');
  if (!userType || userType !== 'student') {
    window.location.replace('index.html');
  }
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ - Ù…Ø¯Ø±Ø³Ø© Ø±ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ…ÙŠØ²</title>
    <link rel="stylesheet" href="css.css">
        <link rel="icon" href="n.icon">

</head>

<body class="student-view">
    <nav class="navbar">
        <div class="nav-container">
            <img src="snapedit_1730146554309.png" class="school-logo" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
            <div class="date-display" id="currentDate"></div>
            <div class="nav-links">
                <!-- Hamburger Menu Button -->
                <button class="hamburger-btn" onclick="toggleMenu()">
                    â˜°
                </button>

                <!-- Mobile Menu -->
                <div class="mobile-menu">
                    <button class="theme-toggle" onclick="toggleTheme()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">
                        <i>ğŸŒ™</i> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
                    </button>
                    <a href="#" class="nav-link" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬" onclick="confirmLogout()">
                        <span class="logout-icon">ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
    <div class="tabs-container">
        <div class="tab active" onclick="activateTabStudent('Ù†Ù‚Ø§Ø·ÙŠ')">Ù†Ù‚Ø§Ø·ÙŠ</div>
        <div class="tab" onclick="activateTabStudent('Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²')">Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²</div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù†Ù‚Ø§Ø·ÙŠ -->
    <div id="nqati-content-student">
        <div class="container">
            <h1>ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</h1>
            <img src="logo.png" alt="Ù†Ù‚Ø§Ø·ÙŠ" style="height: 50px;">
            <div class="control-panel">
                <div class="search-box">
                    <input type="text" id="studentSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨...">
                    <select id="studentStageFilter" onchange="updateStudentClassFilter()">
                        <option value="primary">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©</option>
                        <option value="middle">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</option>
                        <option value="secondary">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©</option>
                    </select>
                    <select id="studentClassFilter">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„</option>
                    </select>
                </div>
            </div>

            <table id="studentsTable">
                <thead>
                    <tr>
                        <th width="15%">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                        <th width="35%">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                        <th width="25%">Ø§Ù„ÙØµÙ„</th>
                        <th width="25%">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                    </tr>
                </thead>
                <tbody id="studentsList"></tbody>
            </table>
        </div>
    </div>

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ² (Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
    <div id="mutamayez-content-student" style="display: none;">
        <div class="container">
             <h1>ØµÙØ­Ø© Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²</h1>
             <img src="logo.png" alt="Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²" style="height: 50px; display: none;"> <!-- Ø¥Ø®ÙØ§Ø¡ Ø´Ø¹Ø§Ø± Ù†Ù‚Ø§Ø·ÙŠ -->
             <div class="control-panel">
                 <div class="search-box">
                    <input type="text" id="mutamayez-studentSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨...">
                     <select id="mutamayez-studentStageFilter">
                         <option value="primary">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©</option>
                         <option value="middle">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</option>
                         <option value="secondary">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©</option>
                     </select>
                     <select id="mutamayez-studentClassFilter">
                         <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„</option>
                     </select>
                 </div>
             </div>
             
             <table id="mutamayez-studentsTable-student">
                 <thead>
                     <tr>
                         <th width="15%">Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                         <th width="35%">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                         <th width="25%">Ø§Ù„ÙØµÙ„</th>
                         <th width="25%">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                     </tr>
                 </thead>
                 <tbody id="mutamayez-studentsList-student"></tbody>
             </table>
        </div>
    </div>

    <footer class="luxury-footer">
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2025 ØµÙ‡ÙŠØ¨ Ù…Ø­Ù…Ø¯ Ø¨ÙˆØ²ÙŠØ¯Ø§Ù†</p>
        <p>ÙŠÙÙ…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ù†Ø´Ø± Ø£Ùˆ ØªÙˆØ²ÙŠØ¹ Ø£ÙŠ Ø¬Ø²Ø¡ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ Ø¯ÙˆÙ† Ø¥Ø°Ù† ÙƒØªØ§Ø¨ÙŠ Ù…Ø³Ø¨Ù‚.</p>
        <p>Ù„Ù„ØªÙˆØ§ØµÙ„: <a href="mailto:suhaibwebdev@gmail.com">suhaibwebdev@gmail.com</a></p>
    </footer>

    <div id="logoutConfirmation" class="confirmation-modal">
        <div class="confirmation-content">
            <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ</p>
            <div class="confirmation-buttons">
                <button onclick="performLogout()" class="confirm-btn">Ù†Ø¹Ù…</button>
                <button onclick="closeLogoutModal()" class="cancel-btn">Ù„Ø§</button>
            </div>
        </div>
    </div>

    <style>
    .confirmation-modal {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
    }
    .confirmation-content {
        background: white;
        width: 300px;
        padding: 20px;
        border-radius: 8px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    .confirmation-buttons {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        justify-content: center;
    }
    .confirm-btn, .cancel-btn {
        padding: 8px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .confirm-btn { background: #4CAF50; color: white; }
    .cancel-btn { background: #f44336; color: white; }
    </style>

    <script>
    function confirmLogout() {
        document.getElementById('logoutConfirmation').style.display = 'block';
    }
    function closeLogoutModal() {
        document.getElementById('logoutConfirmation').style.display = 'none';
    }
    function performLogout() {
        // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
        localStorage.removeItem('user_type');
        window.location.href = "index.html";
    }
    </script>

    <script>
        let students = [];
        let activeTab = 'Ù†Ù‚Ø§Ø·ÙŠ'; // Ø¥Ø¶Ø§ÙØ© Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø·
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙØµÙˆÙ„ Ù„ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©
        const stageClasses = {
            primary: {
                name: 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©',
                classes: ['1/1', '1/2', '2/1', '2/2', '3/1', '3/2', '4/1', '4/2', '5/1', '5/2', '6/1', '6/2']
            },
            middle: {
                name: 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©',
                classes: ['1/1', '1/2', '2/1', '2/2', '3/1', '3/2']
            },
            secondary: {
                name: 'Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©',
                classes: ['1/1', '1/2', '1/3', '2/Ø¹Ø§Ù…', '2/ØµØ­Ø©', '2/Ù‡Ù†Ø¯Ø³Ø©', 'Ø«Ø§Ù„Ø« Ø¹Ø§Ù…/1', 'Ø«Ø§Ù„Ø« Ø¹Ø§Ù…/2', 'Ø«Ø§Ù„Ø« Ø¹Ø§Ù…/3', 'Ø«Ø§Ù„Ø« ØµØ­Ø©/1', 'Ø«Ø§Ù„Ø« ØµØ­Ø©/2', 'Ø«Ø§Ù„Ø« Ù‡Ù†Ø¯Ø³Ø©/1', 'Ø«Ø§Ù„Ø« Ù‡Ù†Ø¯Ø³Ø©/2']
            }
        };

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØµÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
        function updateStudentClassFilter() {
            const stageFilter = document.getElementById('studentStageFilter');
            const classFilter = document.getElementById('studentClassFilter');
            const selectedStage = stageFilter.value;
            
            // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            classFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„</option>';
            
            if (selectedStage && stageClasses[selectedStage]) {
                stageClasses[selectedStage].classes.forEach(className => {
                    const option = document.createElement('option');
                    option.value = className;
                    option.textContent = className;
                    classFilter.appendChild(option);
                });
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨
            updateDisplay();
        }

        // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ (Ù…Ø¹Ø¯Ù„Ø© Ù„ØªÙ‚Ø¨Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙƒÙ…Ø¹Ø§Ù…Ù„)
        function calculateRanks(studentsToRank) {
            const stageFilter = document.getElementById('studentStageFilter').value;
            const classFilter = document.getElementById('studentClassFilter').value;

            // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© (Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙŠ ØªÙ… ØªÙ…Ø±ÙŠØ±Ù‡Ø§)
            const stageSorted = [...studentsToRank].sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                return a.id - b.id;
            });
            stageSorted.forEach((student, index) => {
                student.stageRank = index + 1; // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
            });

            // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„ÙƒÙ„ ÙØµÙ„ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…ÙÙ„ØªØ±Ø© (Ø§Ù„ØªÙŠ ØªÙ… ØªÙ…Ø±ÙŠØ±Ù‡Ø§)
            const stageInfo = stageClasses[stageFilter]; // Ù†Ø³ØªØ®Ø¯Ù… ÙÙ„ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØµÙˆÙ„
            if (stageInfo) {
                stageInfo.classes.forEach(className => {
                    const classStudents = studentsToRank
                        .filter(s => s.class === className) // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù…Ø±Ø±Ø©
                        .sort((a, b) => {
                            if (b.points !== a.points) return b.points - a.points;
                            return a.id - b.id;
                        });
                    classStudents.forEach((student, index) => {
                        student.classRank = index + 1; // Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯
                    });
                });
            }
        }

        function filterAndSort() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const stageFilter = document.getElementById('studentStageFilter').value;
            const classFilter = document.getElementById('studentClassFilter').value;

            console.log('Filtering students for', activeTab, ':', students.length, 'total students');

            // ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø· Ø£ÙˆÙ„Ø§Ù‹ (Ù†Ù‚Ø§Ø·ÙŠ)
            let result = students.filter(student => student.category === activeTab);
            
            // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø¥Ø°Ø§ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡
            if (stageFilter) {
                result = result.filter(student => student.stage === stageFilter);
            }
            
            if (classFilter) {
                result = result.filter(s => s.class === classFilter);
            }
            if (searchTerm) {
                result = result.filter(s => s.name.toLowerCase().includes(searchTerm));
            }
            // Ù„Ø§ Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„ÙØ±Ø² Ø£Ùˆ Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¢Ù†ØŒ Ø³ÙŠØªÙ… Ø°Ù„Ùƒ ÙÙŠ updateDisplay Ùˆ calculateRanks
            return result;
        }

        function updateDisplay() {
            console.log('ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø·Ù„Ø§Ø¨ Ù†Ù‚Ø§Ø·ÙŠ...');
            const classFilter = document.getElementById('studentClassFilter').value;
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ù„Ù„Ø¹Ø±Ø¶
            const filteredStudentsToDisplay = filterAndSort();
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ù„Ù„Ø¹Ø±Ø¶
            calculateRanks(filteredStudentsToDisplay); // ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙÙ„ØªØ±Ø©

            const tbody = document.getElementById('studentsList');
            tbody.innerHTML = '';

            filteredStudentsToDisplay.forEach(student => {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ (stageRank Ø£Ùˆ classRank) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙÙ„ØªØ± Ø§Ù„ÙØµÙ„
                const rank = classFilter ? student.classRank : student.stageRank;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ Ø£ÙˆÙ„Ø§Ù‹
                const row = document.createElement('tr');

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ ÙˆÙØ¦Ø§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
                let rankDisplay = rank;
                if (rank === 1) { 
                    rankDisplay = 'ğŸ¥‡ ' + rank; 
                    row.classList.add('rank-1'); // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ rank-1
                } 
                else if (rank === 2) { 
                    rankDisplay = 'ğŸ¥ˆ ' + rank; 
                    row.classList.add('rank-2'); // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ rank-2
                } 
                else if (rank === 3) { 
                    rankDisplay = 'ğŸ¥‰ ' + rank; 
                    row.classList.add('rank-3'); // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ rank-3
                }

                 if (rank >= 1 && rank <= 10) { 
                    row.classList.add('top-10-row'); // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ top-10-row
                }

                row.innerHTML = `
                    <td>${rankDisplay}</td>
                    <td>${student.name}</td>
                    <td>${student.class}</td>
                    <td>${student.points}</td>
                `;

                tbody.appendChild(row);
            });
        }

        function updateDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ar-EG', options);
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.getElementById('studentSearch').addEventListener('input', updateDisplay);
        document.getElementById('studentClassFilter').addEventListener('change', updateDisplay);
        document.getElementById('studentStageFilter').addEventListener('change', updateStudentClassFilter);

        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            updateDate();
            document.getElementById('studentStageFilter').value = 'primary';
            updateStudentClassFilter();
        });
    </script>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        socket.on("dataUpdated", (newData) => {
            console.log("ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯:", newData);
            students = newData.students;
            const nqatiStudentsCount = students.filter(s => s.category === 'Ù†Ù‚Ø§Ø·ÙŠ').length;
            console.log('Received', students.length, 'total students,', nqatiStudentsCount, 'in Ù†Ù‚Ø§Ø·ÙŠ category');
            if (activeTab === 'Ù†Ù‚Ø§Ø·ÙŠ') {
                updateDisplay();
            } else if (activeTab === 'Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²') {
                updateMutamayezDisplay();
            }
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„
        socket.on("initialData", (data) => {
            console.log("ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:", data);
            students = data.students;
            const nqatiStudentsCount = students.filter(s => s.category === 'Ù†Ù‚Ø§Ø·ÙŠ').length;
            console.log('Received', students.length, 'total students,', nqatiStudentsCount, 'in Ù†Ù‚Ø§Ø·ÙŠ category');
            if (activeTab === 'Ù†Ù‚Ø§Ø·ÙŠ') {
                updateDisplay();
            } else if (activeTab === 'Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²') {
                updateMutamayezDisplay();
            }
        });

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²
        function updateMutamayezDisplay() {
            const searchTerm = document.getElementById('mutamayez-studentSearch').value.toLowerCase();
            const stageFilter = document.getElementById('mutamayez-studentStageFilter').value;
            const classFilter = document.getElementById('mutamayez-studentClassFilter').value;

            // ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø© (Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²)
            let filteredStudents = students.filter(student => student.category === 'Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²');
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
            if (stageFilter) {
                filteredStudents = filteredStudents.filter(student => student.stage === stageFilter);
            }
            if (classFilter) {
                filteredStudents = filteredStudents.filter(student => student.class === classFilter);
            }
            if (searchTerm) {
                filteredStudents = filteredStudents.filter(student => student.name.toLowerCase().includes(searchTerm));
            }

            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
            filteredStudents.sort((a, b) => b.points - a.points || a.id - b.id);

            // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨
            filteredStudents.forEach((student, index) => {
                student.displayRank = index + 1;
            });

            // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const tbody = document.getElementById('mutamayez-studentsList-student');
            tbody.innerHTML = '';

            filteredStudents.forEach(student => {
                const row = document.createElement('tr');
                const rank = student.displayRank;
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙŠØ¯Ø§Ù„ÙŠØ§Øª Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø£ÙˆØ§Ø¦Ù„
                let rankDisplay = rank;
                if (rank === 1) {
                    rankDisplay = 'ğŸ¥‡ ' + rank;
                    row.classList.add('rank-1');
                } else if (rank === 2) {
                    rankDisplay = 'ğŸ¥ˆ ' + rank;
                    row.classList.add('rank-2');
                } else if (rank === 3) {
                    rankDisplay = 'ğŸ¥‰ ' + rank;
                    row.classList.add('rank-3');
                }

                row.innerHTML = `
                    <td>${rankDisplay}</td>
                    <td>${student.name}</td>
                    <td>${student.class}</td>
                    <td>${student.points}</td>
                `;

                if (rank >= 1 && rank <= 10) {
                    row.classList.add('top-10-row');
                }

                tbody.appendChild(row);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© setupMutamayezStudentEventListeners
        function setupMutamayezStudentEventListeners() {
            console.log('Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ² (Ø·Ø§Ù„Ø¨)...');
            const mutamayezContent = document.getElementById('mutamayez-content-student');
            if (!mutamayezContent) return;

            const searchInput = mutamayezContent.querySelector('#mutamayez-studentSearch');
            const stageFilter = mutamayezContent.querySelector('#mutamayez-studentStageFilter');
            const classFilter = mutamayezContent.querySelector('#mutamayez-studentClassFilter');

            // ØªØ¬Ù†Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø±Ø©
            if (mutamayezContent.dataset.listenersAttached === 'true') {
                console.log('Ù…Ø³ØªÙ…Ø¹Ùˆ Ø£Ø­Ø¯Ø§Ø« Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ² (Ø·Ø§Ù„Ø¨) Ù…ÙˆØ¬ÙˆØ¯ÙˆÙ† Ø¨Ø§Ù„ÙØ¹Ù„.');
                return;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¨Ø­Ø«
            if (searchInput) searchInput.addEventListener('input', updateMutamayezDisplay);
            if (stageFilter) stageFilter.addEventListener('change', updateMutamayezDisplay);
            if (classFilter) classFilter.addEventListener('change', updateMutamayezDisplay);

            mutamayezContent.dataset.listenersAttached = 'true';
            console.log('Ø§ÙƒØªÙ…Ù„ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ² (Ø·Ø§Ù„Ø¨).');
        }

        // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© activateTabStudent
        function activateTabStudent(tabName) {
            console.log('ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ (Ø·Ø§Ù„Ø¨):', tabName);
            activeTab = tabName;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
            document.getElementById('nqati-content-student').style.display = 'none';
            document.getElementById('mutamayez-content-student').style.display = 'none';

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ¦Ø© 'active' Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tabs-container .tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø· ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø© 'active' Ù„Ù„ØªØ¨ÙˆÙŠØ¨
            const schoolLogo = document.querySelector('.school-logo');

            if (tabName === 'Ù†Ù‚Ø§Ø·ÙŠ') {
                document.getElementById('nqati-content-student').style.display = 'block';
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                if (schoolLogo) schoolLogo.style.display = 'block';
                updateDisplay();
            } else if (tabName === 'Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²') {
                document.getElementById('mutamayez-content-student').style.display = 'block';
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                if (schoolLogo) schoolLogo.style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©
                setupMutamayezStudentEventListeners();
                updateMutamayezDisplay();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø²Ø± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø²Ø±
            const themeIcon = document.querySelector('.theme-toggle i');
            themeIcon.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù†Ù‚Ø§Ø·ÙŠ) Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            activateTabStudent('Ù†Ù‚Ø§Ø·ÙŠ');
        });
    </script>

    <script>
    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
    function toggleTheme() {
        const body = document.documentElement;
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø²Ø±
        const themeIcon = document.querySelector('.theme-toggle i');
        themeIcon.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    }

    // Ø¯Ø§Ù„Ø© ØªØ¨Ø¯ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‡Ø§Ù…Ø¨Ø±ØºØ±
    function toggleMenu() {
        const mobileMenu = document.querySelector('.mobile-menu');
        mobileMenu.classList.toggle('active');
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.addEventListener('click', (event) => {
        const mobileMenu = document.querySelector('.mobile-menu');
        const hamburgerBtn = document.querySelector('.hamburger-btn');
        if (!mobileMenu.contains(event.target) && !hamburgerBtn.contains(event.target) && mobileMenu.classList.contains('active')) {
            mobileMenu.classList.remove('active');
        }
    });
    </script>

    <script>
    // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ showAlert Ø£Ùˆ Ù‚Ù… Ø¨ØªØ¹Ø±ÙŠÙÙ‡Ø§ Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (typeof showAlert === 'undefined') {
        function showAlert(message, type = 'info') {
            console.log('ALERT (Student):', type, message);
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù‡Ù†Ø§ Ù„ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
            // Ù…Ø«Ø§Ù„ Ø¨Ø³ÙŠØ·:
            // alert(type.toUpperCase() + ': ' + message);
        }
    }
    </script>

    <script>
    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØµÙˆÙ„ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²
    function updateMutamayezClassFilter() {
        const stageFilter = document.getElementById('mutamayez-studentStageFilter');
        const classFilter = document.getElementById('mutamayez-studentClassFilter');
        const selectedStage = stageFilter.value;
        
        // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        classFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„</option>';
        
        if (selectedStage && stageClasses[selectedStage]) {
            stageClasses[selectedStage].classes.forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                classFilter.appendChild(option);
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨
        updateMutamayezDisplay();
    }

    // ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø« Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù†Ø§ Ù…ØªÙ…ÙŠØ²
    document.getElementById('mutamayez-studentStageFilter').addEventListener('change', updateMutamayezClassFilter);
    </script>
</body>
</html>